function playlist_search(){var t=$(".playlist-main-search").val().toLowerCase().trim();$(".popular__playlist-item, .playlist-main-none").show();var l=$(".playlist-category-selector ul li.current").find(".playlist-cat-li-title").text();0<t.length||""!=l?$(".popular__playlist-item").each(function(){var e=$(this).find(".popular__playlist-item-title").text().toLowerCase();(0<t.length&&e.indexOf(t)<0||""!=l&&$(this).data("category").indexOf(l)<0?$(this):$(".playlist-main-none")).hide()}):1<=$(".popular__playlist-item").length&&$(".playlist-main-none").hide()}function playload(e){e?$(".playlist-add-window h3").addClass("pload"):$(".playlist-add-window h3").removeClass("pload")}$(document).on("click","body",function(e){$(e.target).parents(".playlist-add-area").length<1&&($(".playlist-add-window").fadeOut(200),$(".playlist-add-trigger").parents(".playlist-add-area").removeClass("is-active"))}).on("click",".playlist-add-trigger",function(e){e.preventDefault(),$(".playlist-add-window").fadeToggle(200),$(".playlist-add-loading").length&&$.post(dle_root+"engine/ajax/controller.php?mod=playlists",{newsid:$(this).data("id"),action:"load"},function(e){e.error?($(".playlist-add-window").hide(),ModAlert.addAlert({type:"error",title:"Ошибка",text:e.error})):($(".playlist-add-loading").remove(),$(".playlist-add-window").append(e.html))},"json")}).on("keyup",".playlist-add-search",function(){var e=$(this).val().toLowerCase();$(".playlist-add-title").val($(this).val()),$(".playlist-add-list li").show(),0<e.length&&$(".playlist-add-list li").each(function(){$(this).find("span").text().toLowerCase().indexOf(e)<0&&$(this).hide()})}).on("click",".playlist-add-create-button",function(e){$(".playlist-add-create").slideDown(150),$(this).slideUp(150)}).on("click",".playlist-add-link-access",function(e){$(".playlist-access-link").slideToggle(200)}).on("click",".playlist-add-submit",function(e){e.preventDefault();var t,l=$(".playlist-add-title").val();2<l.length&&(playload(1),t=$(".playlist-add-private").prop("checked"),e=$(".playlist-add-link-access").prop("checked"),$.post(dle_root+"engine/ajax/controller.php?mod=playlists",{title:l,personal:t?1:0,link_access:e?1:0,action:"add"},function(e){playload(0),e.error?ModAlert.addAlert({type:"error",title:"Ошибка",text:e.error}):($(".playlist-add-title").val(""),$(".playlist-add-list").append(e.html),$(".playlist-add-create").slideUp(150),$(".playlist-add-create-button").slideDown(150))},"json"))}).on("click",".playlist-add-list li",function(e){e.preventDefault(),playload(1);var t=$(this),e=$(".playlist-add-trigger").data("id");$.post(dle_root+"engine/ajax/controller.php?mod=playlists",{newsid:e,playlist:$(this).data("id"),action:"toggle"},function(e){playload(0),e.error?ModAlert.addAlert({type:"info",title:"Ошибка",text:e.error}):e.added?(t.addClass("current"),ModAlert.addAlert({type:"info",title:"Информация",text:"Тайтл добавлен в плейлист"})):(t.removeClass("current"),ModAlert.addAlert({type:"error",title:"Информация",text:"Тайтл убран из плейлиста"}))},"json")}).on("click",".playlist-create-button",function(e){e.preventDefault(),$(".playlist-add-dialog").dialog({width:"500px",buttons:{"Создать":function(){var t=$(this),e=$(".playlist-add-title").val();2<e.length&&(ShowLoading(),$.post(dle_root+"engine/ajax/controller.php?mod=playlists",{title:e,personal:$(".playlist-add-private").prop("checked")?1:0,link_access:$(".playlist-add-link-access").prop("checked")?1:0,action:"add",user_id:$(".playlist-create-button").data("user")},function(e){HideLoading(0),e.error?ModAlert.addAlert({type:"error",title:"Ошибка",text:e.error}):($(".playlist-add-title").val(""),t.dialog("close"),DLEconfirm("Плейлист успешно создан. Обновить страницу?",dle_confirm,function(){location.reload(!0)}))},"json"))},"Отмена":function(){$(this).dialog("close")}}})}).on("click",".playlist__btn-copybutton",function(e){e.preventDefault(),DLEconfirm("Импортировать данный плейлист в ваши плейлисты?",dle_confirm,function(){ShowLoading(),$.post(dle_root+"engine/ajax/controller.php?mod=playlists",{playlist:$(".js-playlist").data("id"),action:"copy"},function(e){HideLoading(),e.error?ModAlert.addAlert({type:"error",title:"Ошибка",text:e.error}):ModAlert.addAlert({type:"info",title:"Информация",text:"Плейлист импортирован!"})},"json")})}).on("click",".playlist__btn-edit",function(e){e.preventDefault(),$(".playlist-edit-dialog").dialog({width:"500px",buttons:{"Сохранить":function(){ShowLoading(),$.post(dle_root+"engine/ajax/controller.php?mod=playlists",{playlist:$(".js-playlist").data("id"),link_access:$(".playlist-add-link-access").prop("checked")?1:0,personal:$(".playlist-add-private").prop("checked")?1:0,title:$(".playlist-add-title").val(),descr:$(".playlist-add-descr").val(),action:"edit"},function(e){HideLoading(),e.error?ModAlert.addAlert({type:"error",title:"Ошибка",text:e.error}):DLEconfirm(dle_save_ok,dle_confirm,function(){location.reload(!0)})},"json")},"Удалить":function(){DLEconfirm("Удалить весь плейлист?",dle_confirm,function(){ShowLoading(),$.post(dle_root+"engine/ajax/controller.php?mod=playlists",{playlist:$(".js-playlist").data("id"),action:"delete"},function(e){HideLoading(),e.error?ModAlert.addAlert({type:"error",title:"Ошибка",text:e.error}):window.location=e.url},"json")})},"Отмена":function(){$(this).dialog("close")}}})}).on("keyup",".playlist-main-search",function(){playlist_search()}).on("click",".playlist-category-selector-title",function(){$(".playlist-category-selector ul").slideToggle(150)}).on("mouseleave",".playlist-category-selector",function(){$(".playlist-category-selector ul").fadeOut(200)}).on("click",".playlist-category-selector ul li",function(){$(this).hasClass("current")?($(this).removeClass("current"),$(".playlist-category-selector-title").html($(".playlist-category-selector-title").data("title"))):($(this).addClass("current").siblings().removeClass("current"),$(".playlist-category-selector-title").html($(this).find(".playlist-cat-li-title").text())),playlist_search()}).on("click",".playlist__delete-link",function(e){e.preventDefault();var t=$(this);DLEconfirm("Удалить тайтл из плейлиста?",dle_confirm,function(){ShowLoading(),$.post(dle_root+"engine/ajax/controller.php?mod=playlists",{newsid:t.data("id"),playlist:$(".js-playlist").data("id"),action:"toggle"},function(e){HideLoading(),e.error?ModAlert.addAlert({type:"error",title:"Ошибка",text:e.error}):e.added||t.parents(".popular__playlist-item").remove()},"json")})}).on("mouseenter","[data-foto]",function(){var e=$(this).data("foto");$(".popfoto").remove();var t=$(this).offset().left+$(this).width()+50;$("body").append('<img src="'+e+'" class="popfoto" style="top:'+$(this).offset().top+"px;left:"+t+'px;" />'),$(".popfoto").animate({left:"-=40",opacity:1},200,"linear")}).on("mouseleave","[data-foto]",function(){$(".popfoto").fadeOut(150)});var rcats=[];$(".rcats").each(function(e,t){var l=$(this),o=l.text();l.parents(".popular__playlist-item").attr("data-category",o),$.each(o.split("/"),function(e,t){t=t.trim();rcats[t]=null==rcats[t]?1:rcats[t]+1})});var i,li_cats="";for(i in rcats)li_cats+='<li><span class="playlist-cat-li-title">'+i+'</span> <span class="playlist-cat-li-count">'+rcats[i]+"</span></li>";function showOrHideIt(e,t){e=document.getElementById(e),t=document.getElementById(t),e.checked?t.style.display="block":t.style.display="none"}function myFunction(){var e=document.getElementById("myInput");e.select(),document.execCommand("copy"),document.getElementById("myTooltip").innerHTML="Скопирована ссылка: "+e.value}function outFunc(){document.getElementById("myTooltip").innerHTML="Скопировать ссылку в буфер обмена"}function doRatePlaylist(e,l){ShowLoading(""),$.get(dle_root+"engine/ajax/controller.php?mod=ratingplaylist",{go_rate:e,news_id:l,skin:dle_skin,user_hash:dle_login_hash},function(e){var t;HideLoading(""),e.success?(t=(t=(t=(t=e.rating).replace(/&lt;/g,"<")).replace(/&gt;/g,">")).replace(/&amp;/g,"&"),$("#ratig-layer-"+l).html(t),$("#vote-num-id-"+l).html(e.votenum),$("#likes-id-"+l).html(e.likes),$("#dislikes-id-"+l).html(e.dislikes)):e.error&&DLEalert(e.errorinfo,dle_info)},"json")}function doAddCommentsPlaylist(){var o=document.getElementById("dle-comments-form"),e="",t="",l="",i="",a="0",n="";return"1"!=dle_wysiwyg&&"2"!=dle_wysiwyg||("2"==dle_wysiwyg&&tinyMCE.triggerSave(),e="wysiwyg"),""==o.name.value?DLEalert(dle_req_field[0],dle_info):""==o.comments.value?DLEalert(dle_req_field[1],dle_info):(o.question_answer&&(t=o.question_answer.value),o.sec_code&&(l=o.sec_code.value),"1"==dle_captcha_type?"undefined"!=typeof grecaptcha&&(i=grecaptcha.getResponse()):"2"==dle_captcha_type&&(i=$("#g-recaptcha-response").val()),o.allow_subscribe&&1==o.allow_subscribe.checked&&(a="1"),o.mail&&(n=o.mail.value),ShowLoading(""),$.post(dle_root+"engine/ajax/controller.php?mod=addcomments_playlist",{post_id:o.post_id.value,comments:o.comments.value,name:o.name.value,mail:n,editor_mode:e,skin:dle_skin,sec_code:l,question_answer:t,g_recaptcha_response:i,allow_subscribe:a,user_hash:dle_login_hash},function(e){var t,l;HideLoading(""),e.error?$("#dle-ajax-comments").append(e.content):e.success&&($("#comm-id-"+e.id).length?(t=$(e.content).find("#comm-id-"+e.id).html(),$("html,body").stop().animate({scrollTop:$("#comm-id-"+e.id).offset().top-100},600,function(){$("#comm-id-"+e.id).fadeOut("slow",function(){$(this).html(t+"<script>"+e.scripts+"<\/script>"),$("#comm-id-"+e.id).fadeIn("slow")})})):($(e.content+"<script>"+e.scripts+"<\/script>").insertBefore("#dle-ajax-comments"),node=$("#comments-tree-item-"+e.id).length?$("#comments-tree-item-"+e.id):$("#blind-animation-"+e.id),$("html,body").stop().animate({scrollTop:$("#dle-ajax-comments").offset().top-100},600,function(){$(node).show("blind",{},700)})),o.sec_code&&(o.sec_code.value="",reload()),"1"==dle_captcha_type?"undefined"!=typeof grecaptcha&&grecaptcha.reset():"2"==dle_captcha_type&&"undefined"!=typeof grecaptcha&&(l=$("#g-recaptcha-response").data("key"),grecaptcha.execute(l,{action:"comments"}).then(function(e){$("#g-recaptcha-response").val(e)})))},"json")),!1}function CommentsPagePlaylist(t,l,o){return ShowLoading(""),$.get(dle_root+"engine/ajax/controller.php?mod=playlist_comments",{cstart:t,news_id:l,skin:dle_skin},function(e){HideLoading(""),isNaN(t)||isNaN(l)||($("#dle-comm-link").off("click"),$("#dle-comm-link").on("click",function(){return CommentsPagePlaylist(t,l),!1})),scroll(0,$("#dle-comments-list").offset().top-100),$("#dle-comments-list").html(e.comments),$(".dle-comments-navigation").html(e.navigation),isHistoryApiAvailable()&&window.history.pushState(null,null,o)},"json"),!1}function ajax_fast_reply_playlist(e,t,l){var o="";"1"!=dle_wysiwyg&&"2"!=dle_wysiwyg||("2"==dle_wysiwyg&&tinyMCE.triggerSave(),o="wysiwyg");var i=$("#comments"+e).val(),a=$("#name"+e).val(),n=$("#question_answer"+e).val(),s=$("#sec_code"+e).val(),d=$("#subscribe"+e+":checked").val(),r=$("#postid"+e).val(),c="";return""==a?DLEalert(dle_req_field[0],dle_info):""==i?DLEalert(dle_req_field[1],dle_info):("1"==dle_captcha_type?"undefined"!=typeof grecaptcha&&(c=grecaptcha.getResponse(recaptcha_widget)):"2"==dle_captcha_type&&(c=$("#comments-recaptcha-response"+e).val()),d=d||0,s=s||"",n=n||"",ShowLoading(""),$.post(dle_root+"engine/ajax/controller.php?mod=addcomments_playlist",{post_id:r,parent:e,indent:t,comments:i,name:a,mail:"",editor_mode:o,skin:dle_skin,sec_code:s,question_answer:n,g_recaptcha_response:c,allow_subscribe:d,user_hash:dle_login_hash,needwrap:l},function(e){var t;HideLoading(""),e.error?$(e.content).insertBefore("#dlefastreplyesponse"):e.success&&($("#comm-id-"+e.id).length?(t=$(e.content).find("#comm-id-"+e.id).html(),$("#dlefastreplycomments").hide(),$("html,body").stop().animate({scrollTop:$("#comm-id-"+e.id).offset().top-100},600,function(){$("#comm-id-"+e.id).fadeOut("slow",function(){$(this).html(t+"<script>"+e.scripts+"<\/script>"),$("#comm-id-"+e.id).fadeIn("slow")})})):($(e.content+"<script>"+e.scripts+"<\/script>").insertBefore("#dlefastreplyesponse"),$("#dlefastreplycomments").hide("blind",{},500),setTimeout(function(){$("html,body").stop().animate({scrollTop:$("#dlefastreplyesponse").offset().top-100},600,function(){$("#comments-tree-item-"+e.id).show("blind",{},700)})},600)))},"json")),!1}function dle_reply_playlist(d,r,t){var l={},c="",p=0;return $("#dlereplypopup").remove(),$("#dlefastreplyesponse").remove(),$("#dlefastreplycomments").remove(),$("#comment-id-"+d).next(".comments-tree-list").length?$("#comment-id-"+d).next(".comments-tree-list").append("<div id='dlefastreplyesponse'></div>"):($("<div id='dlefastreplyesponse'></div>").insertAfter("#comment-id-"+d),p=1),l[dle_act_lang[3]]=function(){$(this).dialog("close")},l[dle_p_send]=function(){"1"!=dle_wysiwyg&&"2"!=dle_wysiwyg||("2"==dle_wysiwyg&&tinyMCE.triggerSave(),c="wysiwyg");var e=$("#comments"+d).val(),t=$("#name"+d).val(),l=$("#mail"+d).val(),o=$("#question_answer"+d).val(),i=$("#sec_code"+d).val(),a=$("#subscribe"+d+":checked").val(),n=$("#postid"+d).val(),s="";return""==t?DLEalert(dle_req_field[0],dle_info):""==e?DLEalert(dle_req_field[1],dle_info):("1"==dle_captcha_type?"undefined"!=typeof grecaptcha&&(s=grecaptcha.getResponse(recaptcha_widget)):"2"==dle_captcha_type&&(s=$("#comments-recaptcha-response"+d).val()),a=a||0,i=i||"",o=o||"",ShowLoading(""),$.post(dle_root+"engine/ajax/controller.php?mod=addcomments_playlist",{post_id:n,parent:d,indent:r,comments:e,name:t,mail:l,editor_mode:c,skin:dle_skin,sec_code:i,question_answer:o,g_recaptcha_response:s,allow_subscribe:a,user_hash:dle_login_hash,needwrap:p},function(e){var t;HideLoading(""),e.error?$(e.content).insertBefore("#dlefastreplyesponse"):e.success&&($("#dlereplypopup").remove(),$("#comm-id-"+e.id).length?(t=$(e.content).find("#comm-id-"+e.id).html(),$("#dlefastreplycomments").hide(),$("html,body").stop().animate({scrollTop:$("#comm-id-"+e.id).offset().top-100},600,function(){$("#comm-id-"+e.id).fadeOut("slow",function(){$(this).html(t+"<script>"+e.scripts+"<\/script>"),$("#comm-id-"+e.id).fadeIn("slow")})})):($(e.content+"<script>"+e.scripts+"<\/script>").insertBefore("#dlefastreplyesponse"),$("#dlefastreplycomments").hide("blind",{},500),setTimeout(function(){$("html,body").stop().animate({scrollTop:$("#dlefastreplyesponse").offset().top-100},600,function(){$("#comments-tree-item-"+e.id).show("blind",{},700)})},600)))},"json")),!1},ShowLoading(""),$.get(dle_root+"engine/ajax/controller.php?mod=replycomments_playlist",{id:d,indent:r,skin:dle_skin,user_hash:dle_login_hash,needwrap:p},function(e){HideLoading(""),"0"!=t?($("<div id='dlefastreplycomments' style='display:none'></div>").insertAfter("#comment-id-"+d),$("#dlefastreplycomments").html(e),$("html,body").stop().animate({scrollTop:$("#comment-id-"+d).offset().top+$("#comment-id-"+d).height()-100},600),setTimeout(function(){$("#dlefastreplycomments").show("blind",{},700)},600)):($("body").append("<div id='dlereplypopup' title='"+dle_reply_title+"' style='display:none'></div>"),$("#dlereplypopup").html(e),$("#dlereplypopup").dialog({autoOpen:!0,width:800,resizable:!1,dialogClass:"modalfixed dle-popup-replycomments",buttons:l}),$(".modalfixed.ui-dialog").css({position:"fixed"}),$(".dle-popup-replycomments").css({cssText:"width:800px; max-height: none !important"}),$("#dlereplypopup").css({cssText:"height: auto !important"}),$("#dlereplypopup").dialog("option","position",{my:"center",at:"center",of:window}))},"html"),!1}function ajax_comm_edit_playlist(t,e){for(var l=0,o=c_cache.length;l<o;l++)l in c_cache&&""!=c_cache[l]&&ajax_cancel_comm_edit(l);return c_cache[t]&&""!=c_cache[t]||(c_cache[t]=$("#comm-id-"+t).html()),ShowLoading(""),$.get(dle_root+"engine/ajax/controller.php?mod=editcomments_playlist",{id:t,area:e,action:"edit"},function(e){HideLoading(""),$("#comm-id-"+t).html(e),setTimeout(function(){$("html,body").stop().animate({scrollTop:$("#comm-id-"+t).offset().top-100},700)},100)},"html"),!1}function ajax_save_comm_edit_playlist(t,e){"2"==dle_wysiwyg&&tinyMCE.triggerSave();var l=$("#dleeditcomments"+t).val();return ShowLoading(""),$.post(dle_root+"engine/ajax/controller.php?mod=editcomments_playlist",{id:t,comm_txt:l,area:e,action:"save",user_hash:dle_login_hash},function(e){HideLoading(""),c_cache[t]="",$("#comm-id-"+t).html(e)}),!1}function DeleteCommentsPlaylist(e,t){DLEconfirm(dle_del_agree,dle_confirm,function(){ShowLoading(""),$.get(dle_root+"engine/ajax/controller.php?mod=deletecomments_playlist",{id:e,dle_allow_hash:t},function(e){var t;HideLoading(""),e=parseInt(e),isNaN(e)||(t=null,t="1"==dle_tree_comm?$("#comments-tree-item-"+e):$("#comment-id-"+e),$("html,body").stop().animate({scrollTop:t.offset().top-70},700),setTimeout(function(){t.hide("blind",{},1400)},700))})})}function doCommentsRatePlaylist(e,l){ShowLoading(""),$.get(dle_root+"engine/ajax/controller.php?mod=ratingcomments_playlist",{go_rate:e,c_id:l,skin:dle_skin,user_hash:dle_login_hash},function(e){var t;HideLoading(""),e.success?(t=(t=(t=(t=e.rating).replace(/&lt;/g,"<")).replace(/&gt;/g,">")).replace(/&amp;/g,"&"),$("#comments-ratig-layer-"+l).html(t),$("#comments-vote-num-id-"+l).html(e.votenum),$("#comments-likes-id-"+l).html(e.likes),$("#comments-dislikes-id-"+l).html(e.dislikes)):e.error&&DLEalert(e.errorinfo,dle_info)},"json")}function dle_ins_playlist(e){if(!document.getElementById("dle-comments-form"))return!1;var t=document.getElementById("dle-comments-form").comments,l="",o="";return""!=dle_txt?("0"==dle_wysiwyg||"-1"==dle_wysiwyg?(t.value+=dle_txt+"\n",setTimeout(function(){t.focus()},800),o=".bb-editor"):(l=dle_txt,o=".wseditor","1"==dle_wysiwyg?($("#comments").froalaEditor("events.focus"),$("#comments").froalaEditor("html.insert",l,!0)):tinyMCE.execCommand("mceInsertContent",!1,l)),setTimeout(function(){$("html,body").stop().animate({scrollTop:$(o).offset().top-100},700)},100)):(ShowLoading(""),$.get(dle_root+"engine/ajax/controller.php?mod=quote_playlist",{id:e,user_hash:dle_login_hash},function(e){HideLoading(""),e=(e=(e=(e=(e=(e=(e=e.replace(/&lt;/g,"<")).replace(/&gt;/g,">")).replace(/&amp;/g,"&")).replace(/&quot;/g,'"')).replace(/&#039;/g,"'")).replace(/&#039;/g,"'")).replace(/&#34;/g,'"'),"0"==dle_wysiwyg||"-1"==dle_wysiwyg?(t.value+=e+"\n",setTimeout(function(){t.focus()},800),o=".bb-editor"):(l=e,o=".wseditor","1"==dle_wysiwyg?($("#comments").froalaEditor("events.focus"),$("#comments").froalaEditor("html.insert",l+"<br>",!0)):tinyMCE.execCommand("mceInsertContent",!1,l+"<p><br></p>")),setTimeout(function(){$("html,body").stop().animate({scrollTop:$(o).offset().top-100},700)},100)})),!1}$(".playlist-category-selector ul").html(li_cats);