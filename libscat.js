$(function(){var a=null,e="default",n=!1,o=+localStorage.getItem("ps_lang");o&&c();var t=localStorage.getItem("ps_sort");function l(){n=!0,$(".ac-result-list").html("").show(),$(".ac-result-empty").hide(),$(".ac-result").fadeIn(150).addClass("loading"),$(".overlay__alphabet").fadeIn(200),$.ajax({url:dle_root+"engine/mods/catalog/list",type:"POST",dataType:"html",data:{symbol:a,sort:e}}).done(function(t){t?(setTimeout(function(){$(window).lazyLoadXT()},300),$(".ac-result-list").html(t)):($(".ac-result-list").hide(),$(".ac-result-empty").fadeIn(200),$(".overlay__alphabet").fadeOut(200))}).fail(function(t){s(),DLEalert(t.responseText,"Ошибка")}).always(function(){$(".ac-result").removeClass("loading"),n=!1})}function i(t,a,e){ShowLoading(),$.ajax({url:dle_root+"engine/mods/catalog/settings/"+t,type:"POST",dataType:"html",data:a}).done(function(t){e(t)}).fail(function(t){DLEalert(t.responseText,"Ошибка")}).always(function(){HideLoading()})}function s(){return $(".ac-result").fadeOut(200),$(".ac-catalog li a").removeClass("active"),!1}function c(){localStorage.setItem("ps_lang",o),$(".ac-catalog-lang").find("span").toggleClass("current"),$(".ac-catalog-rus, .ac-catalog-eng").toggleClass("current")}function r(){ShowLoading(),$.ajax({url:dle_root+"engine/mods/catalog/rebuild/",type:"POST",dataType:"html"}).done(function(t){$("body").append(t),function e(n){$.ajax({url:dle_root+"engine/mods/catalog/rebuild/start",type:"POST",dataType:"html"}).done(function(t){var a=$(".ac-rebuild-progress").data("pages");if(n==a)return $(".ac-rebuild-area").fadeOut(400,function(){$(this).remove()}),DLEalert("Символьный каталог успешно перестроен",dle_info),!1;n++,a=Math.round(100*n/a),a+="%",$(".ac-rebuild-bar").css({width:a}),$(".ac-rebuild-progress-info").html(a),e(n)}).fail(function(t){DLEalert(t.responseText,"Ошибка")}).always(function(){HideLoading()})}(0)}).fail(function(t){DLEalert(t.responseText,"Ошибка")}).always(function(){HideLoading()})}t&&(e=t,$(".ac-sort li[data-sort="+e+"]").addClass("current").siblings().removeClass("current")),$(document).on("click",".ac-catalog-lang",function(t){t.preventDefault(),o=1-o,c()}).on("click",".ac-catalog li a",function(t){return t.preventDefault(),!n&&($(this).hasClass("active")?s():!!$(this).data("symbol")&&($(".ac-catalog li a").removeClass("active"),$(this).addClass("active"),a=$(this).data("symbol"),$(".ac-result-link").attr("href",$(this).attr("href")),void l()))}).on("click",".ac-sort li:not(.current)",function(t){return t.preventDefault(),!n&&($(this).addClass("current").siblings().removeClass("current"),e=$(this).data("sort"),localStorage.setItem("ps_sort",e),void l())}).on("click",".ac-settings-link",function(t){t.preventDefault(),s(),$("#ac-settings").remove(),$("body").append('<div id="ac-settings" style="display:none"/>'),i("",{},function(t){$("#ac-settings").html(t).dialog({title:"Настройки символьного каталога",width:800,buttons:{"Сохранить":function(){var a={};$("#ac-settings [name]").each(function(){var t=$(this).prop("name");"checkbox"==$(this).prop("type")?$(this).prop("checked")&&(a[t]=1):a[t]=$(this).val()}),i("save",a,function(){DLEalert("Настройки успешно сохранены",dle_info)})},"Перестроить":function(){r()},"Закрыть":function(){$(this).dialog("close")}}})})}).on("click","body",function(t){$(t.target).closest(".ajax-catalog").length<1&&s()})});