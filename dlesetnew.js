function doRateLD(e,a){ShowLoading(""),$.get(dle_root+"engine/ajax/rating.php",{go_rate:e,news_id:a,skin:dle_skin,user_hash:dle_login_hash},function(e){var t,n,o,i;HideLoading(""),e.success?(o=(o=(o=(o=e.rating).replace(/&lt;/g,"<")).replace(/&gt;/g,">")).replace(/&amp;/g,"&"),$("#ratig-layer-"+a).html(o),$("#vote-num-id-"+a).html(e.votenum),i=parseInt($(o).text()),t=(e.votenum-i)/2,n=e.votenum-t,o=Math.round(n/e.votenum*100),(i=$("#frate-"+a)).find(".rate-plus span.rcount").html(n),i.find(".rate-minus span.rcount").html(t),i.find(".rfill").css({width:o+"%"}),i.find(".rate-perc").html(o+"%")):e.error&&DLEalert(e.errorinfo,dle_info)},"json")}function DLE_Notifications(t,n=!1){$.get(dle_root+"engine/ajax/controller.php?mod=notifications",{action:t,notif_id:n,user_hash:dle_login_hash},function(e){"list"==t?($(".guest__notification").html(e.notice_count),$("#alertsDropdownList").html(e.notice_list),$("#alertsDropdownListMob").html(e.notice_list)):"main_delete"==t?($("#delete-"+n).hide("slow"),DLE_Notifications("list")):"delete"==t?($("#notification-"+n).remove(),DLE_Notifications("list")):"full_delete"==t?document.location.reload():"read"==t?($("#notification-"+n).removeClass("unread"),$("#notreaded-"+n).hide(),$("#readed-"+n).show()):"unread"==t?($("#notification-"+n).addClass("unread"),$("#notreaded-"+n).show(),$("#readed-"+n).hide()):"full_read"==t?document.location.reload():DLEalert(e.error,"Внимание")},"json")}function PostSubscribe(e,t){$.get(dle_root+"engine/ajax/controller.php?mod=notifications",{post_id:e,subaction:t,user_hash:dle_login_hash},function(e){e.status?"subscribe"==t?($("#subscribe_to").hide(),$("#unsubscribe_from").show()):($("#subscribe_to").show(),$("#unsubscribe_from").hide()):DLEalert(e.error,"Внимание")},"json")}$("#alertsDropdownHere").click(function(){return 5==dle_group?(DLEalert("Уведомления доступны только для авторизованных пользователей","Внимание"),!1):void $("#alertsDropdownList").toggleClass("is-active")}),jQuery.fn.wRateCount=function(){return this.each(function(){var e=$(this),t=parseInt(e.find(".ratingtypeplusminus").text(),10),n=parseInt(e.find("span[id*=vote]").text(),10);t<=n&&0<n&&(n=Math.round((n-(n-t)/2)/n*100),n=Math.round(n),e.parent().append('<div class="poster__rating-fill" style="width:'+n+'%"></div>')),e.removeClass("js-count-rating")})},$(document).ready(function(){5!=dle_group&&(DLE_Notifications("list"),setInterval(DLE_Notifications("list"),6e4))}),$(document).ready(function(){$(document).on("click",".favmod",function(e){e.preventDefault();var t=$(this);ShowLoading("Загрузка"),$.ajax({url:dle_root+"engine/mods/favorites/ajax.php",type:"POST",dataType:"json",data:{newsid:t.data("id")}}).done(function(){t.toggleClass("active")}).fail(function(e){DLEalert(e.responseText,dle_info)}).always(function(){HideLoading()})}),$(".iframe__season-full").each(function(){$(this).find("a:first").addClass("is-active")}),$(document).on("click",".comment-item__main--spoiler",function(){$(this).removeClass("comment-item__main--spoiler")}),$("[data-showitems]").each(function(){var e=$(this),t=e.children().length,n=e.data("showitems");n<t&&($(e).children(":gt("+n+")").hide(),$(e).after('<div class="showitems-btn">Показать все ('+t+")</div>"))}),$(document).on("click",".showitems-btn",function(){$(this).prev().children().show(),$(this).remove()}),$(document).on("click",".pmovie__translations",function(){$(".transl__popup").dialog({autoOpen:!0,width:600,minHeight:160,resizable:!1,buttons:{Ok:function(){$(this).dialog("close")}},close:function(){$(".overlay").fadeOut(200)},open:function(){$(".overlay").fadeIn(200)}})}),$(document).on("click",".filter__open",function(){$(".filter").slideToggle(200)}),$(".js-count-rating").wRateCount(),$(".tabs-block").each(function(){$(this).find(".tabs-block__select span:first").addClass("is-active"),$(this).find(".tabs-block__content:first").removeClass("d-none")}),$(".tabs-block__select").on("click","span:not(.is-active)",function(){$(this).addClass("is-active").siblings().removeClass("is-active").parents(".tabs-block").find(".tabs-block__content").hide().eq($(this).index()).fadeIn(0),setTimeout(function(){$(window).lazyLoadXT()},300)}),$("body").append('<div class="overlay"></div><div class="mobile-menu" id="mobile-menu"></div><div class="mobile-menu-close"><span class="fal fa-times"></span></div><div id="scrolltop"><span class="fal fa-long-arrow-up"></span></div>'),$(".js-this-in-mobile-menu").each(function(){$(this).clone().appendTo("#mobile-menu")}),$(document).on("click",".js-show-login",function(){return $(".overlay, .login").fadeIn(200),$("body").addClass("modal-is-opened"),setTimeout(function(){$(window).lazyLoadXT()},300),!1}),$(".js-scroll-to").click(function(){$("html, body").animate({scrollTop:$(".pmovie__player").offset().top-10},800)}),$(".js-show-comments").click(function(){$(".page__comments").fadeIn(0,function(){$("html, body").animate({scrollTop:$(".page__comments").offset().top-20},800)})}),$(".js-show-mobile-menu").click(function(){$(".overlay").fadeIn(200),$("#mobile-menu, .mobile-menu-close").addClass("is-active"),$("body").addClass("mobile-menu-is-opened")}),$(document).on("click",".overlay, .login__close, .mobile-menu-close",function(){$(".overlay, .login").fadeOut(200),$("#mobile-menu, .mobile-menu-close").removeClass("is-active"),$("body").removeClass("modal-is-opened mobile-menu-is-opened")}),$(document).on("click",".form__textarea-inside textarea, .fr-wrapper",function(){$(".add-comments-form").find(".form__row--protect").removeClass("d-none")}),$("#dle-content > #dle-ajax-comments").appendTo($("#page__comments-list")),$(".login__social-btns a").on("click",function(){var e=$(this).attr("href"),t=(screen.width-820)/2,n=(screen.height-420)/2-100;return auth_window=window.open(e,"auth_window","width=820,height=420,top="+n+",left="+t+"menubar=no,resizable=no,scrollbars=no,status=no,toolbar=no"),!1}),$(".js-comm-author").each(function(){var e=(i=$(this)).closest(".js-comm"),t=i.text().substr(0,1),n=e.find(".js-comm-avatar"),o=n.children("img").attr("src"),i=["#c57c3b","#753bc5","#79c53b","#eb3b5a","#45aaf2","#2bcbba","#778ca3"],e=Math.floor(Math.random()*i.length);o=="/templates/"+dle_skin+"/dleimages/noavatar.png"&&n.html('<div class="comment-item__letter d-flex jc-center ai-center" style="background-color:'+i[e]+'">'+t+"</div>")});var e=$("#scrolltop");$(window).scroll(function(){300<$(this).scrollTop()?e.fadeIn(200):e.fadeOut(200)}),e.click(function(){$("html, body").animate({scrollTop:0},"slow")}),setTimeout(function(){},3e3)}),$(document).ready(function(){$(".frate").each(function(){var e=$(this),t=e.find(".rate-data"),n=parseInt(t.find(".ratingtypeplusminus").text(),10),o=parseInt(t.find("span[id*=vote]").text(),10);e.append('<div class="rbar"><div class="rfill"></div></div>'),e.find(".rate-plus").after('<div class="rate-perc">0%</div>'),n<=o&&0<o?(n=o-(t=(o-n)/2),o=Math.round(n/o*100),e.find(".rate-plus span.rcount").html(n),e.find(".rate-minus span.rcount").html(t),e.find(".rfill").css({width:o+"%"}),e.find(".rate-perc").html(o+"%"),o<49?e.find(".rate-perc").addClass("low"):e.find(".rate-perc").addClass("high")):(e.find(".rate-plus span.rcount").html("0"),e.find(".rate-minus span.rcount").html("0")),e.addClass("done")})});